{% set mpi = mpi %}
{% set openmp = openmp %}
{% set enable_mpi = "ON" if mpi != "nompi" else "OFF" %}
{% set enable_openmp = "ON" if openmp == "on" else "OFF" %}

package:
  name: hypre
  version: 3.1.0

source:
  path: ..

build:
  number: 0
  string: mpi_{{ mpi }}_openmp_{{ openmp }}
  skip: true  # [win]
  script_env:
    - MPI_VARIANT={{ mpi }}
    - OPENMP_VARIANT={{ openmp }}

requirements:
  build:
    - {{ compiler("c") }}
    - {{ compiler("cxx") }}
    - cmake
    - make
  host:
    - libstdcxx-ng  # [linux]
    - libcxx  # [osx]
    {% if mpi == "openmpi" %}
    - openmpi
    {% elif mpi == "mpich" %}
    - mpich
    {% endif %}
  run:
    - libstdcxx-ng  # [linux]
    - libcxx  # [osx]
    {% if mpi == "openmpi" %}
    - {{ pin_compatible("openmpi", max_pin="x.x") }}
    {% elif mpi == "mpich" %}
    - {{ pin_compatible("mpich", max_pin="x.x") }}
    {% endif %}

about:
  home: https://github.com/hypre-space/hypre
  license: Apache-2.0
  license_file: LICENSE-APACHE
  summary: >
    HYPRE sparse linear solver library with configurable MPI and OpenMP builds.

test:
  commands:
    - test -f "${PREFIX}/include/HYPRE.h"
    - if [ "${target_platform}" = "linux-64" ]; then test -f "${PREFIX}/lib/libHYPRE.so"; fi
    - if [[ "${target_platform}" == osx-* ]]; then test -f "${PREFIX}/lib/libHYPRE.dylib"; fi
